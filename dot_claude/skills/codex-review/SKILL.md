---
name: codex-review
description: |
  OpenAI Codex CLIを使ったコードレビュースキル。
  plan作成時と実装完了時の2つのタイミングでCodexによるレビューを実施する。
  Use when: plan作成完了時、実装完了時、コードレビュー依頼時、codexレビュー、品質チェック
  Triggers: codex review, コードレビュー, レビュー依頼, plan完了, 実装完了, 品質チェック
license: MIT
metadata:
  author: sparkle01
  version: "1.0.0"
---

# Codex Review

OpenAI Codex CLIを使い、**plan作成時**と**実装完了時**にコードレビューを実施するスキル。

## レビュータイミング

### タイミング1: Plan作成時（設計レビュー）

planモードでプランを作成し終えた時点で、プランの内容をCodexにレビューさせる。

**目的**: 実装前に設計上の問題を早期発見する
**観点**:
- アーキテクチャの妥当性
- 見落としているエッジケース
- パフォーマンス上の懸念
- セキュリティリスク
- より良いアプローチの提案

**実行手順**:

1. プラン内容を一時ファイルに書き出す
2. 以下のコマンドを実行する:

```bash
bash ~/.claude/skills/codex-review/scripts/review-plan.sh "<planの内容またはファイルパス>"
```

3. 結果をユーザーに共有し、プランに反映すべき指摘があれば修正する

### タイミング2: 実装完了時（コードレビュー）

実装が完了した時点で、mainブランチとの差分をCodexにレビューさせる。

**目的**: マージ前にコード品質を担保する
**観点**:
- Correctness（ロジックの正確性）
- Performance（パフォーマンス問題）
- Security（セキュリティ脆弱性）
- Maintainability（保守性・可読性）
- Best Practices（フレームワーク固有のベストプラクティス）

**実行手順**:

1. 以下のコマンドを実行する:

```bash
bash ~/.claude/skills/codex-review/scripts/review-code.sh
```

2. 結果をユーザーに共有する
3. Critical/Highの指摘があれば修正を提案する

## エラーハンドリング

- `codex` コマンドが見つからない場合: レビューをスキップし、ユーザーに「Codex CLIが未インストールのためレビューをスキップしました。`npm install -g @openai/codex` でインストールできます。」と伝える
- APIキーが未設定の場合: レビューをスキップし、ユーザーに「Codex認証が未設定のためレビューをスキップしました。`codex` を一度起動してログインしてください。」と伝える
- レビューがタイムアウトまたは失敗した場合: レビューをスキップし、ユーザーに「Codexレビューが失敗しました。手動でレビューしてください。」と伝える
- **いずれの場合も作業をブロックしない**。レビューは補助的なものとして扱う

## レポート形式

```markdown
## 🔍 Codex Review（{plan|code}）

### 指摘事項

- **[Critical]** 説明...
- **[High]** 説明...
- **[Medium]** 説明...
- **[Low]** 説明...

### 良い点

- ...

### 総合評価

{全体的な評価}
```

## 補足

- レビュー結果はあくまで参考情報。最終判断はユーザーとClaude自身が行う
- Codexの指摘が的外れな場合は無視してよい
- 大きなdiffの場合は、変更ファイルを絞ってレビューすることを推奨
